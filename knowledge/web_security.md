# web 安全

https://mp.weixin.qq.com/s/rU32rVM6Q-ele01ZB3RFzg

## 同源策略

如果两个 URL 的协议，域名和端口都相同，我们就称这两个 URL 同源

同源策略限制来：

1. 限制来自不同源的 JS 脚本对当前 DOM 对象读和写的操作
2. 限制不同源的站点读取当前站点的 cookie，IndexDB，localStorage 等数据
3. 限制通过 XMLHttpRequest 等方式将站点的数据发送给不同源的站点

解决同源策略的方法：

1. 跨稳定消息机制
   通过 window.postMessage 的 JS 接口来和不同源的 DOM 进行通信
2. 跨资源共享（CORS）
   跨域资源在服务端设置允许跨域，就可以进行跨域访问控制，从而使跨域数据传输得以安全进行
3. 内容安全策略（CSP）
   主要是以白名单的形式配置可信任的内容来源，在网页中，能够使白名单中的内容正常执行（包含 JS，CSS，Image 等等），而非白名单的内容无法正常执行
4. nginx 的反向代理

## XSS（跨站脚本攻击）

原理是恶意攻击者往 web 页面里插入恶意可执行网页脚本代码，当用户浏览该页面时，嵌入 web 里面的脚本代码会被执行，从而可以达到攻击者盗取
用户信息或者其他侵犯用户安全隐私的目的。

根据插入类型大致分为 3 类：

1. 存储型 XSS 攻击（比如留言板）（来源后端从数据库中读出来的数据）
   - 比如在 input，textarea 等所有可能输入文本信息的区域，输入<script src="http://恶意网站">等，提交后信息会存在服务器中，当用户再次打开网站请求到相应的数据，打开页面，恶意脚本就会将用户的 cookie 信息等数据上传到黑客服务器
2. 反射型 XSS 攻击（比如诱骗用户点击 URL 连接）（来源于 URL，referer，forms）
   - 用户将一段含有恶意代码的请求提交给 web 服务器，web 服务器接收到请求时，又将恶意代码反射给了浏览器端。
   - 如邮件里的恶意连接
3. 基于 DOM 的 XSS 攻击（在传输中修改数据）

   - 特点是在 web 资源传输过程或者在用户使用页面的过程中修改 web 页面数据。
   - 比如利用工具（如 Burpsuite）扫描目标网站所有的网页并自动测试写好的注入脚本等。

预防策略：

- 转义字符
- HttpOnly Cookie
- 特殊字符进行判断
- CSP（白名单）
  设置 http header 中的 Content-security-policy
  设置 meta 标签的方式

## CSRF（跨站请求伪造）

在利用用户已经登录的身份，在用户毫不知情的情况下，以用户的名义完成非法操作。

完成 CSRF 攻击的三个条件：

1. 用户已经登录了站点 A，并在本地记录了 cookie
2.
3.

预防策略

## SQL 注入

利用漏洞访问和修改数据，或者利用潜在的数据库漏洞进行攻击

## 点击劫持

点击劫持是一种视觉欺骗的攻击手段。通过 iframe 嵌套的方式嵌入自己的网页中，并将 iframe 设置为透明的，在页面中透出一个按钮诱导用户点击

防御策略： 1. 2. 3.

## URL 跳转漏洞

## window.opener 安全问题

## 文件上传漏洞
